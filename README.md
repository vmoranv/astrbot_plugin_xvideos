# AstrBot XVideos 插件

AstrBot 的 XVideos 视频搜索和信息查询插件，支持富媒体消息展示

## 功能特性

- 🔍 **视频搜索**: 根据关键词搜索视频
- 📹 **视频详情**: 查看视频的详细信息（标题、时长、观看数、点赞等）
- 🖼️ **封面图片**: 自动下载并处理视频封面（支持打码）
- 📱 **富媒体消息**: 使用 MessageChain 展示图片和文本，提供更好的用户体验
- ️ **缓存管理**: 支持缓存搜索结果，减少API请求
- 🧹 **自动清理**: 发送消息后自动清理临时文件
- ⚙️ **可配置**: 支持代理、打码程度、缓存时间等配置

## 配置

在 AstrBot 的插件配置页面可以配置以下选项：

| 配置项 | 说明 | 默认值 |
|--------|------|---------|
| `proxy_url` | 代理地址，例如: `http://127.0.0.1:7890` | 空 |
| `blur_level` | 封面图片打码程度 (0-100)，0为不打码，100为完全模糊 | 50 |
| `max_results` | 搜索结果最大数量 | 10 |
| `cache_enabled` | 是否启用缓存 | true |
| `cache_ttl` | 缓存过期时间（秒） | 3600 |

## 命令列表

### `/xv_search <关键词>`
搜索视频

**示例**:
```
/xv_search 测试
```

**输出**:
```
🔍 搜索结果: 测试
找到 5 个结果:

[图片 - 视频1封面]
1. 测试视频标题
   ID: 123456 | 时长: 10:00 | 观看: 1.2M

[图片 - 视频2封面]
2. 另一个视频标题
   ID: 789012 | 时长: 15:00 | 观看: 2.5M

...（最多显示5个视频）

💡 使用 /xv_info <ID> 查看详情
```

**注意**: 所有内容（图片+文本）会在一条富媒体消息中发送，提供更好的浏览体验。

### `/xv_info <视频ID>`
获取视频详细信息

**示例**:
```
/xv_info 123456
```

**输出**:
```
📹 标题: 视频标题
⏱️ 时长: 10:00
👁️ 观看: 1.2M
👍 点赞: 15K
👎 踩: 500
🏷️ 标签: 标签1, 标签2, 标签3

[图片 - 视频封面]
```

**注意**: 文本信息和封面图片会在一条富媒体消息中发送。

## 注意事项

1. **视频ID格式**: 视频ID通常是纯数字，例如 `123456`
2. **URL前缀**: 插件已硬编码URL前缀，只需提供视频ID即可
3. **自动清理**: 每次发送消息前会自动清理上一次的临时文件，无需手动清理
4. **打码处理**: 封面图片会根据配置的打码程度进行模糊处理
5. **缓存机制**: 启用缓存后，相同的搜索结果会从缓存读取
6. **插件终止**: 插件停用时会自动清理所有临时文件

## 数据存储

插件数据存储在以下目录：
```
data/plugin_data/astrbot_plugin_xvideos/
├── cache/          # 缓存文件
└── temp/           # 临时文件
```

## 依赖

- `xvideos-api>=1.0.0` - XVideos API 库
- `aiohttp>=3.8.0` - 异步HTTP客户端
- `Pillow>=9.0.0` - 图片处理
- `beautifulsoup4>=4.11.0` - HTML解析
- `lxml>=4.9.0` - XML/HTML解析器

## 许可证

GPL-3.0

## 作者

vmoranv

## 仓库

https://github.com/vmoranv/astrbot_plugin_xvideos

## 支持

如有问题或建议，请提交 [Issue](https://github.com/vmoranv/astrbot_plugin_xvideos/issues) 或 [Pull Request](https://github.com/vmoranv/astrbot_plugin_xvideos/pulls)。
